# 往診ルート最適化システム 画面設計書

## 1. 画面構成概要

### 1-1. 画面レイアウト
- **レイアウト方式**: 単一画面型（SPA: Single Page Application）
- **画面分割**: 左右2カラム + 下部結果表示エリア
- **レスポンシブ対応**: タブレット・PC対応（モバイルは将来対応）

### 1-2. 画面遷移図
```
[起動画面]
    ↓
[ログイン画面] (PoC段階は簡易パスワード認証)
    ↓
[メイン画面] ←→ [設定画面]
    ├─ 患者登録タブ
    ├─ 医師登録タブ
    ├─ 緊急往診タブ
    └─ ルート計算結果表示
```

---

## 2. 各画面の詳細設計

### 2-1. ログイン画面（初回起動時のみ）

#### 画面レイアウト
```
┌─────────────────────────────────────┐
│   往診ルート最適化システム          │
│                                     │
│   [マスターパスワード入力]          │
│   ┌─────────────────────────────┐   │
│   │ パスワード: [___________]   │   │
│   └─────────────────────────────┘   │
│                                     │
│   [ログイン]  [キャンセル]          │
│                                     │
│   ※ 初回起動時はパスワード設定     │
└─────────────────────────────────────┘
```

#### 機能
- マスターパスワードによる認証
- 初回起動時はパスワード設定画面を表示
- パスワードは暗号化キーの生成に使用

---

### 2-2. メイン画面

#### 画面レイアウト（全体構成）
```
┌─────────────────────────────────────────────────────────────┐
│  🏥 往診ルート最適化システム - 管制塔                       │
├─────────────────────────────────────────────────────────────┤
│                                                             │
│  ┌──────────────────────┐  ┌──────────────────────┐        │
│  │ 左カラム: データ登録 │  │ 右カラム: ルート計算│        │
│  │                      │  │                      │        │
│  │ [患者] [医師] [緊急] │  │ [朝一計算]          │        │
│  │                      │  │ [昼計算]            │        │
│  │ フォーム表示エリア   │  │ [緊急計算]          │        │
│  │                      │  │                      │        │
│  │ 登録済み一覧         │  │ 計算ステータス      │        │
│  └──────────────────────┘  └──────────────────────┘        │
│                                                             │
│  ┌──────────────────────────────────────────────────────┐  │
│  │ 計算結果表示エリア                                   │  │
│  │                                                      │  │
│  │ 医師Aのルート:                                       │  │
│  │   1. 患者① → 移動5分 → 診察15分                    │  │
│  │   2. 患者③ → 移動8分 → 診察20分                    │  │
│  │   全体終了: 10:50                                    │  │
│  │                                                      │  │
│  │ 医師Bのルート:                                       │  │
│  │   1. 患者② → 移動3分 → 診察10分                    │  │
│  │   全体終了: 10:41                                    │  │
│  └──────────────────────────────────────────────────────┘  │
│                                                             │
│  ┌──────────────────────┐  ┌──────────────────────┐        │
│  │ 計算履歴             │  │ システム管理         │        │
│  └──────────────────────┘  └──────────────────────┘        │
└─────────────────────────────────────────────────────────────┘
```

---

### 2-3. 患者登録タブ

#### 画面要素
1. **入力フォーム**
   - 患者ID（必須、テキスト入力）
   - 患者氏名（必須、テキスト入力）
   - 住所（必須、テキスト入力）
     - 補足: 「緯度経度は自動取得されます」
   - 電話番号（任意、テキスト入力）
   - 診察推定時間（必須、数値入力、1～120分）
   - 担当医師（必須、ドロップダウン選択）

2. **登録ボタン**
   - 「登録」ボタン（プライマリカラー）

3. **登録済み患者一覧**
   - 患者ID、氏名、診察時間、担当医師、住所（一部表示）
   - 各項目に編集・削除ボタン（将来実装）

#### 操作フロー
```
1. フォームに入力
2. 「登録」ボタンをクリック
3. バリデーション実行
   - 必須項目チェック
   - データ型チェック
   - 重複チェック（患者ID）
4. 住所から緯度経度を取得（Google Maps Geocoding API）
5. データベースに保存（機密情報は暗号化）
6. 一覧に追加表示
7. 監査ログに記録
```

#### エラー表示
- 必須項目未入力: フィールド下に赤文字でエラーメッセージ
- 重複ID: 「この患者IDは既に登録されています」
- APIエラー: 「住所の取得に失敗しました。手動で緯度経度を入力してください」

---

### 2-4. 医師登録タブ

#### 画面要素
1. **入力フォーム**
   - 医師ID（必須、テキスト入力）
   - 医師氏名（必須、テキスト入力）
   - 現在地（読み取り専用、医療機関所在地が初期値）

2. **登録ボタン**
   - 「登録」ボタン（プライマリカラー）

3. **登録済み医師一覧**
   - 医師ID、氏名、担当患者数、現在地

#### 操作フロー
```
1. フォームに入力
2. 「登録」ボタンをクリック
3. バリデーション実行
4. データベースに保存
5. 一覧に追加表示
6. 監査ログに記録
```

---

### 2-5. 緊急往診タブ

#### 画面要素
1. **緊急往診入力フォーム**（黄色背景で強調）
   - 患者ID（必須）
   - 住所（必須）
   - 診察推定時間（必須）
   - 優先度（緊急/通常）

2. **緊急登録ボタン**（赤色で強調）
   - 「緊急登録 & 再計算」ボタン

#### 操作フロー
```
1. 緊急往診情報を入力
2. 「緊急登録 & 再計算」ボタンをクリック
3. 現在のスケジュール + 新規患者で再計算
4. 計算結果を表示
   - どの医師が対応すべきか提示
   - 全体終了時間の変化を表示
5. ユーザーが確認して医師に指示
6. 監査ログに記録（緊急対応として）
```

#### 表示内容
- 緊急往診の追加による影響を視覚的に表示
  - 「全体終了時間が10分延長されます」
  - 「医師Aが対応する場合: 全体終了 10:50」
  - 「医師Bが対応する場合: 全体終了 10:55」

---

### 2-6. ルート計算エリア

#### 画面要素
1. **計算ボタン**
   - 「🌅 朝一計算」ボタン（緑色）
   - 「☀️ 昼計算」ボタン（緑色）
   - 「🚨 緊急割り込み計算」ボタン（青色）

2. **計算ステータス表示**
   - 未実行 / 計算中 / 計算完了 / エラー

#### 操作フロー
```
1. 計算ボタンをクリック
2. 「計算中...」表示
3. バックエンドで最適化計算実行
   - Google Maps APIで移動時間取得
   - 貪欲法でルート最適化
4. 計算結果を下部の結果表示エリアに表示
5. 計算履歴に記録
```

#### エラー表示
- Google Maps APIエラー: 「移動時間の取得に失敗しました。手動入力に切り替えますか？」
- 患者未登録: 「患者が登録されていません」
- 医師未登録: 「医師が登録されていません」

---

### 2-7. 計算結果表示エリア

#### 画面要素
1. **計算情報サマリー**
   - 計算種別（朝一/昼/緊急）
   - 実行日時
   - 全体終了予定時刻（強調表示）

2. **医師ごとのルート表示**
   - 医師名
   - 各患者の順序（番号付き）
   - 移動時間、診察時間、到着予定時刻
   - 診療終了予定時刻

#### 表示形式
```
┌─────────────────────────────────────┐
│ 計算種別: 朝一計算                  │
│ 実行日時: 2026/01/15 09:00         │
│ 全体終了予定時刻: 10:50            │
├─────────────────────────────────────┤
│ 👨‍⚕️ 医師A（田中）                   │
│                                     │
│ ① 患者①（P001）                    │
│    移動時間: 5分 | 診察時間: 15分  │
│    到着予定: 09:05                  │
│                                     │
│ ② 患者③（P003）                    │
│    移動時間: 8分 | 診察時間: 20分  │
│    到着予定: 09:28                  │
│                                     │
│ 診療終了予定時刻: 10:04            │
├─────────────────────────────────────┤
│ 👩‍⚕️ 医師B（佐藤）                   │
│  ...                                │
└─────────────────────────────────────┘
```

#### 操作
- 結果の印刷（将来実装）
- 結果のエクスポート（CSV形式、将来実装）
- 結果の保存（自動で計算履歴に保存）

---

### 2-8. 計算履歴エリア

#### 画面要素
1. **履歴一覧**
   - 実行日時
   - 計算種別
   - 実行者
   - 患者数
   - 全体終了予定時刻
   - 「詳細」ボタン

2. **詳細表示**（モーダルまたは別エリア）
   - 過去の計算結果を再表示
   - 比較機能（将来実装）

---

### 2-9. システム管理エリア

#### 画面要素
1. **バックアップ実行ボタン**
   - 「💾 バックアップ実行」ボタン
   - クリックで即座にバックアップ実行
   - 成功/失敗メッセージを表示

2. **データエクスポートボタン**
   - 「📤 データエクスポート」ボタン
   - CSV/JSON形式でエクスポート
   - 管理者権限が必要

3. **設定ボタン**
   - 「🔧 設定」ボタン
   - 設定画面に遷移

---

### 2-10. 設定画面（モーダルまたは別画面）

#### 画面要素
1. **Google Maps API設定**
   - APIキー入力
   - APIキーのテストボタン

2. **バックアップ設定**
   - バックアップ先フォルダ選択
   - 自動バックアップの有効/無効
   - バックアップ保持期間設定

3. **データ保持期間設定**
   - 患者情報保持期間
   - 計算履歴保持期間
   - 監査ログ保持期間

4. **セキュリティ設定**
   - マスターパスワード変更
   - セッションタイムアウト設定

---

## 3. UI/UXデザインガイドライン

### 3-1. カラースキーム
- **プライマリカラー**: #667eea（紫系）
- **セカンダリカラー**: #6c757d（グレー）
- **成功カラー**: #28a745（緑）
- **警告カラー**: #ffc107（黄）
- **危険カラー**: #dc3545（赤）
- **背景色**: #f5f5f5（ライトグレー）
- **カード背景**: #ffffff（白）

### 3-2. タイポグラフィ
- **フォント**: 'Hiragino Sans', 'Hiragino Kaku Gothic ProN', 'Yu Gothic', 'Meiryo', sans-serif
- **見出し1**: 24px, 太字
- **見出し2**: 18px, 太字
- **本文**: 14px
- **補足テキスト**: 12px, グレー

### 3-3. ボタンデザイン
- **プライマリボタン**: 紫背景、白文字、ホバー時に影
- **セカンダリボタン**: グレー背景、白文字
- **成功ボタン**: 緑背景、白文字
- **危険ボタン**: 赤背景、白文字
- **パディング**: 12px 24px
- **角丸**: 4px

### 3-4. フォームデザイン
- **入力フィールド**: 白背景、グレーボーダー、フォーカス時に紫ボーダー
- **ラベル**: 太字、グレー
- **必須マーク**: 赤のアスタリスク（*）
- **エラーメッセージ**: 赤文字、フィールド下に表示

### 3-5. カードデザイン
- **背景**: 白
- **影**: 0 2px 8px rgba(0,0,0,0.1)
- **角丸**: 8px
- **パディング**: 20px

### 3-6. レスポンシブデザイン
- **PC（1024px以上）**: 2カラムレイアウト
- **タブレット（768px～1023px）**: 1カラムレイアウト
- **モバイル（768px未満）**: 将来対応

---

## 4. 操作フロー詳細

### 4-1. 通常の運用フロー（朝一計算）
```
1. システム起動
   ↓
2. ログイン（マスターパスワード）
   ↓
3. メイン画面表示
   ↓
4. 患者登録タブで患者情報を登録
   ↓
5. 医師登録タブで医師情報を登録（初回のみ）
   ↓
6. ルート計算エリアで「朝一計算」ボタンをクリック
   ↓
7. 計算結果表示エリアに結果が表示
   ↓
8. 結果を確認して医師に指示
   ↓
9. 診療終了後、バックアップ実行
```

### 4-2. 緊急往診対応フロー
```
1. メイン画面で緊急往診タブを選択
   ↓
2. 緊急往診情報を入力
   ↓
3. 「緊急登録 & 再計算」ボタンをクリック
   ↓
4. 計算結果表示エリアに更新されたルートが表示
   ↓
5. 「どの医師が対応すべきか」を確認
   ↓
6. 医師に指示
   ↓
7. 監査ログに記録
```

---

## 5. エラー表示とユーザーフィードバック

### 5-1. エラーメッセージ表示
- **位置**: エラーが発生したフィールドの直下
- **色**: 赤（#dc3545）
- **アイコン**: ⚠️（警告アイコン）

### 5-2. 成功メッセージ表示
- **位置**: 画面トップ（トースト通知形式）
- **色**: 緑（#28a745）
- **アイコン**: ✓（チェックマーク）
- **自動非表示**: 3秒後に自動で消える

### 5-3. ローディング表示
- **計算中**: スピナー + 「計算中です。しばらくお待ちください...」
- **位置**: 計算結果表示エリア内

---

## 6. アクセシビリティ

### 6-1. キーボード操作
- Tabキーでフォーカス移動
- Enterキーでフォーム送信
- Escキーでモーダル閉じる

### 6-2. スクリーンリーダー対応
- 適切なaria-label属性
- 見出しの階層構造（h1 → h2 → h3）

### 6-3. 色のコントラスト
- WCAG 2.1 AA基準に準拠
- テキストと背景のコントラスト比 4.5:1以上

---

## 7. パフォーマンス要件

### 7-1. 画面表示速度
- 初回ロード: 2秒以内
- タブ切り替え: 0.3秒以内
- 計算結果表示: 5秒以内（API呼び出し含む）

### 7-2. レスポンシブ性
- ボタンクリック: 即座に反応（0.1秒以内）
- フォーム入力: リアルタイムバリデーション（入力後0.5秒以内）

---

## 8. 将来拡張予定のUI要素

### Phase 2
- [ ] 地図表示（Google Maps埋め込み）
- [ ] リアルタイム位置情報表示
- [ ] ドラッグ&ドロップで患者順序変更
- [ ] グラフ表示（移動距離の推移等）

### Phase 3
- [ ] モバイルアプリUI
- [ ] プッシュ通知
- [ ] 音声入力対応
