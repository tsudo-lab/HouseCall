# 往診ルート最適化システム — 要件整理・競合分析・勝算評価

## 📋 requirements.md の読み込み結果

要件定義書を読みました。以下の理解であっているか確認させてください。

### システムの本質

```mermaid
graph LR
    A["管制塔オペレータ<br/>（1台のPC）"] --> B["往診ルート最適化エンジン<br/>Python/Flask + SQLite"]
    B --> C["医師Aのルート"]
    B --> D["医師Bのルート"]
    B --> E["医師Cのルート"]
    F["Google Maps API"] --> B
    
    style A fill:#4a90d9,color:#fff
    style B fill:#e74c3c,color:#fff
```

> **ポイント整理:**
> - ❌ クラウドサービスではない（ローカル実行）
> - ❌ 医師がアプリを操作しない（管制塔が全管理）
> - ❌ 患者も利用しない（医療従事者間の内部ツール）
> - ✅ **ルート最適化に特化した管制塔ツール**
> - ✅ NG医師・希望時間帯・終了時間平準化が核心の制約

これは、先に分析した **ZEST** のようなSaaS型プラットフォームとは**根本的にカテゴリが異なる**プロダクトです。

---

## 1. 競合マッピング

### 直接競合の比較

| 項目 | **あなたのシステム** | **ZEST** | **CrossLog** | **メディレクター** | **CareMaker** |
|------|-------------------|---------|-------------|----------------|-------------|
| **料金** | 自社開発（API費のみ） | 従量課金（要問合せ） | 要問合せ | 要問合せ | 要問合せ |
| **形態** | ローカル実行 | クラウド SaaS | クラウド SaaS | クラウド SaaS | クラウド SaaS |
| **ルート最適化** | ✅ 制約付き最適化 | ✅ AI自動作成 | ✅ AI最適化提案 | ✅ AI自動計算 | ✅ AI自動作成 |
| **GPS追跡** | ❌（Phase 2） | ✅ | ✅ Tracker | ✅ | ❌ |
| **電子カルテ連携** | ❌（Phase 3） | ✅ | ✅ | ✅ | ❌ |
| **終了時間平準化** | ✅ **独自** | ❌ 不明 | ❌ | ❌ | ❌ |
| **NG医師制約** | ✅ **独自** | 条件設定あり | 担当固定 | 条件設定あり | 条件設定あり |
| **緊急割り振り** | ✅ **自動提案** | ✅ GPS活用 | ✅ GPS活用 | ❌ 不明 | ❌ |
| **オフライン** | ✅（ローカル） | ✅ | ❌ | ❌ | ❌ |
| **同時ユーザー** | ❌ 1台のみ | ✅ | ✅ | ✅ | ✅ |
| **セキュリティ** | SQLCipher暗号化 | ISMS/3省2ガイドライン | クラウドセキュリティ | クラウドセキュリティ | クラウドセキュリティ |

### ポジショニング

```mermaid
quadrantChart
    title 競合ポジショニングマップ
    x-axis "シンプル" --> "多機能"
    y-axis "安価" --> "高価"
    quadrant-1 "ニッチ高額"
    quadrant-2 "フル機能SaaS"
    quadrant-3 "あなたの領域"
    quadrant-4 "汎用低価格"
    "ZEST": [0.85, 0.75]
    "CrossLog": [0.7, 0.6]
    "メディレクター": [0.8, 0.7]
    "CareMaker": [0.6, 0.5]
    "あなたのシステム": [0.35, 0.15]
```

---

## 2. SWOT分析

### 💪 強み（Strengths）

| 強み | 説明 |
|------|------|
| **コスト構造** | ローカル実行のため月額サブスク不要。API費用のみ（¥0〜5,000/月） |
| **独自の最適化ロジック** | 終了時間平準化・NG医師制約・緊急割り振り自動提案は**他社に明示されていない差別化要素** |
| **データの完全自社管理** | クラウドに医療データを送らないことは、セキュリティ懸念の強い医療機関に刺さる |
| **カスタマイズ性** | 自社開発のため、現場の運用に合わせた細かい調整が可能 |

### 🔻 弱み（Weaknesses）

| 弱み | 説明 |
|------|------|
| **単一PC依存** | 管制塔PCが壊れたら業務停止。BCP（事業継続）リスク |
| **スケーラビリティ** | 医師20名以上になるとローカル SQLite の限界が来る |
| **GPS非対応（Phase 1）** | 緊急往診で「今どこにいるか」がわからないのは競合に劣る |
| **UIの洗練度** | 自作 SPA は、ZESTやCrossLogの洗練されたUIには勝てない |
| **1人開発リスク** | 開発・保守が1人に依存する場合、持続性に不安 |

### 🌍 機会（Opportunities）

| 機会 | 説明 |
|------|------|
| **クラウド嫌いの医療機関** | データを外に出したくない保守的な医療機関は多い |
| **高額SaaSへの不満** | ZEST等の料金が不透明（要問合せ）で、中小クリニックは費用負担を嫌う |
| **終了時間平準化ニーズ** | 「特定の医師だけ遅くなる」問題は現場の不満として大きい |

### ⚠️ 脅威（Threats）

| 脅威 | 説明 |
|------|------|
| **競合のAI進化** | ZEST等がAI最適化を強化すると、独自ロジックの優位性が薄れる |
| **クラウド化の潮流** | 医療DXの流れでクラウド移行が進み、ローカルツールは時代遅れと見られるリスク |
| **電子カルテ連携のハードル** | Phase 3 まで電子カルテ連携がないと、業務上の二重入力が発生 |

---

## 3. 勝てるか？ — 正直な評価

### 🟡 判定: **限定的なポジションでは勝てる。正面勝負は厳しい。**

#### ❌ 正面勝負が厳しい理由

1. **ZEST は数年の先行投資** — AIスケジュール自動作成・GPS追跡・電子カルテ連携・ISMS認証まで揃っている。同じ土俵で戦うには数千万円規模の開発が必要
2. **「ローカル実行 × 管制塔1台」の限界** — 複数拠点の医療法人には対応できない
3. **営業力・信頼性** — 医療機関は「実績のあるサービス」を選ぶ傾向が強い

#### ✅ 勝てるシナリオ

| シナリオ | 説明 |
|---------|------|
| **① 自院専用ツールとして使う** | 外販せず、自分たちのクリニックの業務効率化ツールとして活用。コスト: API費のみ。**最も確実** |
| **② ニッチ特化で小規模クリニックに展開** | 「月額0円・ローカルで安全・終了時間平準化」を武器に、ZEST の料金に手が出ない小規模クリニック（医師2〜5名）にターゲティング |
| **③ ルート最適化エンジンだけを切り出す** | 最適化ロジック（NG医師・平準化・緊急割り振り）をAPI/ライブラリとして他社に提供 |

---

## 4. 要件に基づくAPI・コスト再整理

### 実際に必要なAPI（requirements.md ベース）

あなたのシステムは**ローカル実行**のため、必要なAPIは非常にシンプルです。

| API | 用途 | 無料枠 | 超過後の単価 | 月額見込み |
|-----|------|--------|------------|----------|
| **Google Maps Distance Matrix API** | 患者宅間の移動時間計算 | 10,000要素/月 | $5/1,000要素 | **¥0〜3,000** |
| **Google Maps Directions API** | 地図上のルート経路生成 | 10,000リクエスト/月 | $5/1,000リクエスト | **¥0〜1,500** |
| **Google Maps Geocoding API** | 住所→緯度経度変換 | 10,000リクエスト/月 | $5/1,000リクエスト | **¥0〜500** |
| **Google Maps JavaScript API** | 地図表示（Web画面） | 28,000読込/月 | $7/1,000読込 | **¥0** |

> [!TIP]
> **小規模（医師3名・1日計30患者）の場合:**
> - Distance Matrix: 3名 × 10患者 × 10組合せ = 300要素/日 → 約9,000要素/月 → **無料枠内**
> - Directions: 3ルート/日 → 約90リクエスト/月 → **無料枠内**
> - Geocoding: 新規患者登録時のみ → **無料枠内**
> 
> → **Google Maps API は月額 ¥0 で運用可能な可能性が高い**

### インフラコスト（requirements.md ベース）

| 項目 | 費用 | 備考 |
|------|------|------|
| **SQLite + SQLCipher** | ¥0 | OSS、ライセンス無料 |
| **Python / Flask** | ¥0 | OSS |
| **Google OR-Tools** | ¥0 | OSS（ルート最適化エンジンとして推奨） |
| **ホスティング** | ¥0 | ローカル実行 |
| **SSL/認証** | ¥0 | ローカルのため不要（Phase 1） |
| **バックアップ** | ¥0 | ローカルストレージまたはUSB |

### 月額コスト合計（Phase 1）

| 項目 | 金額 |
|------|------|
| Google Maps API | ¥0〜3,000 |
| ソフトウェアライセンス | ¥0 |
| インフラ | ¥0 |
| **合計** | **¥0〜3,000/月** |

> [!IMPORTANT]
> **Supabase は不要です。** requirements.md の設計は完全ローカル実行（SQLite + SQLCipher）なので、クラウドDBの費用はかかりません。将来 Phase 2 でクラウド移行する場合のみ Supabase 等の検討が必要です。

---

## 5. 推奨戦略

### 今すぐやるべきこと

```mermaid
graph TD
    A["Phase 1: 自院ツール（3月）"] --> B["実運用で効果実証"]
    B --> C{効果あり？}
    C -->|Yes| D["Phase 2: 小規模展開検討"]
    C -->|No| E["アルゴリズム改善"]
    D --> F["WebアプリSaaS化 or<br/>パッケージ販売"]
    
    style A fill:#27ae60,color:#fff
    style B fill:#f39c12,color:#fff
    style F fill:#3498db,color:#fff
```

| ステップ | 内容 | 期間 |
|---------|------|------|
| **① まず自院ツールとして完成させる** | requirements.md の Phase 1 を実装し、3月から実運用検証 | 〜3月 |
| **② 効果を数値で測定する** | KPI（移動距離削減率、終了時間ばらつき）を定量的に記録 | 3〜4月 |
| **③ 実績ベースで外販を検討** | 「自院で X% 削減した」という実績が最強の営業ツール | 4月〜 |

### 外販する場合の追加コスト

| 項目 | 追加費用 | 必要性 |
|------|---------|--------|
| クラウド化（Supabase Pro） | ¥3,750/月 | マルチユーザー対応時 |
| ホスティング（Vercel） | ¥0〜3,000/月 | Web版公開時 |
| ドメイン・SSL | ¥1,000〜3,000/年 | Web版公開時 |
| 3省2ガイドライン対応 | ¥90,000〜/月（Supabase Team等） | 医療機関への外販時 |

---

## 6. 議論ポイント

以下の点について、ご意見をお聞かせください。

1. **このシステムは自院専用ツール？それとも将来外販を目指すもの？**
   - 自院専用なら Phase 1 の設計で十分。外販ならクラウド化・セキュリティ認証が必要
   
2. **Google OR-Tools の採用について**
   - 現在の要件にある「貪欲法」より、OR-Tools の VRP ソルバーの方が**終了時間平準化・制約条件を扱いやすい**。無料。採用を推奨

3. **Phase 2 の GPS 機能はどの程度重要？**
   - 緊急往診の割り振りで「最寄りの医師」を判断するには GPS が必須。ただし Phase 1 では「現在地 = 最後に診察した患者宅」で代用可能

4. **電子カルテ連携の方針**
   - Phase 1 では CSV インポートで十分か？連携先のカルテシステムは決まっているか？
